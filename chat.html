<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Chat</title>
  <link rel="stylesheet" href="./styles/main.css">
</head>

<body>
  <div class="pag-chat">
    <div class="chat">
      <div class="chat-left">
        <header class="chat-header">
          <h2>Usuarios conectados</h2>
        </header>
        <div class="js_list_users list-users">
        </div>
      </div>
      <div class="chat-right">
        <header class="chat-header">
          <h1>CHAT CODIGO</h1>
        </header>
        <main class="chat-main">
          <div class="js_wellcome_user"></div>
        </main>
        <footer class="chat-footer">
          <form>
            <textarea class="form-control" required type="text">
            </textarea>
          </form>
        </footer>
      </div>
    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();
    function wellcomeUser() {
      const div = document.createElement('div');
      div.classList.add('alert');
      const user = sessionStorage.getItem('user');
      const container = document.querySelector('.js_wellcome_user');

      div.innerHTML = `Bienvenido ${user}`;

      container.appendChild(div);
    };

    function htmlListUsers(users) {
        const usersFilter = users.filter(user => user !== sessionStorage.getItem('user'));
        const container = document.querySelector('.js_list_users');
        container.innerHTML = '';
        
        usersFilter.map((user) => {
          const div = document.createElement('div');
          div.classList.add('item-user');
          div.innerHTML = `${user} <span class="connected"></span>`;

          container.appendChild(div);
        });            
    }

    function connectUser() {
      const user = sessionStorage.getItem('user');
      socket.emit('channel_connectUser', user);
      socket.on('channel_connectUser', htmlListUsers)
    }

    function init() {
      wellcomeUser(); 
      connectUser();
    }

    (sessionStorage.getItem('user')) ? init() : location.href = '/'
  </script>
</body>

</html>